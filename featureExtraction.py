#Feature Extraction
import os

malwareFileLocation = "C:\\Users\\Ben\\Desktop\\Malware"

listOfFiles = os.listdir(malwareFileLocation)
listOfFiles.sort()

listOfOpcodes = set()

with open(malwareFileLocation+"\\featuresExtracted", "w") as featureFile:
	for fileName in listOfFiles:
		#Ignore byte file and the featureExtracted File
		if(".bytes" in fileName or "featuresExtracted" in fileName):
			continue
		
		#Extract all the different type of opcode
		with open(malwareFileLocation+"\\"+fileName, "r") as reader:	
			#Calculate frequency of opcode, how to handle aggregated opcode like movjz
			for line in reader:
				#Look only at text which is byte code so break when it enters data section
				if ".rdata" in line:
					print("End of text")
					break
				
				#Check if it is converting a hex value
				splittedData = line.split()
				try:
					int(splittedData[1], 16)
				except:
					continue
				
				#Reiterate till non hex which is the opcode
				for a in range(2, len(splittedData)):
					#Check if it is hex
					try:
						int(splittedData[a], 16)
					except:
						#Issue with overflowing of hex data
						if("+" == splittedData[a][-1]):
							listOfOpcodes.add(splittedData[a+1])
						else:	

							listOfOpcodes.add(splittedData[a])
						break
					#Check if lowercase due to dd
					if splittedData[a].islower():
						listOfOpcodes.add(splittedData[a])
						break
						
					if(a == len(splittedData)-1):
						print("Something when wrong when looking")
						print(splittedData)
print(listOfOpcodes)